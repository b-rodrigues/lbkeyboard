<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Typing Effort Model - Implementation and Verification • lbkeyboard</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css"><script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet"><script src="pkgdown.js"></script><meta property="og:title" content="Typing Effort Model - Implementation and Verification"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">


    <div class="container template-title-body">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">lbkeyboard</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="articles/getting-started.html">Getting Started with lbkeyboard</a>
    </li>
    <li>
      <a href="articles/luxembourg-optimization.html">Optimizing Keyboard Layouts for Luxembourg</a>
    </li>
    <li>
      <a href="articles/rules-system.html">Composable Rules System</a>
    </li>
  </ul></li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">
    <div class="page-header">
      <h1>Typing Effort Model - Implementation and Verification</h1>
    </div>

<div id="typing-effort-model---implementation-and-verification" class="section level1">

<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a></h2>
<p>This document describes the Carpalx-inspired typing effort model implemented in <code>lbkeyboard</code> and how to verify its correctness.</p>
</div>
<div class="section level2">
<h2 id="model-components">Model Components<a class="anchor" aria-label="anchor" href="#model-components"></a></h2>
<p>The typing effort model evaluates keyboard layouts using five weighted components:</p>
<div class="section level3">
<h3 id="id_1-base-effort-w_base--30">1. Base Effort (w_base = 3.0)<a class="anchor" aria-label="anchor" href="#id_1-base-effort-w_base--30"></a></h3>
<p>Each key has an intrinsic difficulty based on three factors:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a>base_effort <span class="op">=</span> row_penalty × finger_penalty × home_distance_penalty</span></code></pre></div>
<p><strong>Row Penalties:</strong> - Number row (row 0): 3.0 (hardest - far reach) - Top row (row 1): 1.2 (easy upward reach) - Home row (row 2): 0.5 (easiest - resting position, <strong>2.4x better than top</strong>) - Bottom row (row 3): 2.0 (harder - curling fingers under)</p>
<p><strong>Finger Penalties:</strong> - Pinky (fingers 0, 9): 2.2 (weakest) - Ring (fingers 1, 8): 1.4 - Middle (fingers 2, 7): 1.0 - Index (fingers 3-6): 0.85 (strongest)</p>
<p><strong>Home Distance Penalty:</strong></p>
<pre><code>penalty = 1.0 + 0.3 × distance_from_home_column</code></pre>
<p>30% penalty for each column away from resting position.</p>
</div>
<div class="section level3">
<h3 id="id_2-same-finger-bigram-penalty-w_same_finger--30">2. Same-Finger Bigram Penalty (w_same_finger = 3.0)<a class="anchor" aria-label="anchor" href="#id_2-same-finger-bigram-penalty-w_same_finger--30"></a></h3>
<p>Very high penalty when consecutive keys use the same finger:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode cpp"><code class="sourceCode cpp"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>penalty <span class="op">=</span> <span class="fl">3.0</span> <span class="op">+</span> <span class="fl">2.0</span> × euclidean_distance<span class="op">(</span>key1<span class="op">,</span> key2<span class="op">)</span></span></code></pre></div>
<p>This is extremely inefficient because it requires finger movement instead of hand alternation.</p>
</div>
<div class="section level3">
<h3 id="id_3-same-hand-bigram-penalty-w_same_hand--05">3. Same-Hand Bigram Penalty (w_same_hand = 0.5)<a class="anchor" aria-label="anchor" href="#id_3-same-hand-bigram-penalty-w_same_hand--05"></a></h3>
<p>Penalty for consecutive keys on the same hand with different fingers:</p>
<ul><li>
<strong>Inward rolls</strong> (index → pinky): 0.5 (comfortable)</li>
<li>
<strong>Outward rolls</strong> (pinky → index): 1.2 (awkward)</li>
</ul><p>Plus <strong>row change penalty</strong> if keys are in different rows.</p>
</div>
<div class="section level3">
<h3 id="id_4-row-change-penalty-w_row_change--05">4. Row Change Penalty (w_row_change = 0.5)<a class="anchor" aria-label="anchor" href="#id_4-row-change-penalty-w_row_change--05"></a></h3>
<p>Penalty for reaching between rows on the same hand:</p>
<ul><li>Same row: 0.0</li>
<li>Adjacent rows: 0.3</li>
<li>Multiple row jumps: 0.6 × number_of_rows</li>
</ul></div>
<div class="section level3">
<h3 id="id_5-new-same-hand-trigram-penalty-w_trigram--03">5. <strong>NEW: Same-Hand Trigram Penalty (w_trigram = 0.3)</strong>
<a class="anchor" aria-label="anchor" href="#id_5-new-same-hand-trigram-penalty-w_trigram--03"></a></h3>
<p>Penalty for three consecutive keys on the same hand:</p>
<ul><li>
<strong>Monotonic sequences</strong> (all inward or all outward): 0.5
<ul><li>Example: index → middle → ring (smooth roll)</li>
</ul></li>
<li>
<strong>Direction-changing sequences</strong>: 2.0 (awkward)
<ul><li>Example: index → middle → index (changes direction)</li>
</ul></li>
</ul></div>
</div>
<div class="section level2">
<h2 id="total-effort-formula">Total Effort Formula<a class="anchor" aria-label="anchor" href="#total-effort-formula"></a></h2>
<pre><code>Total Effort = w_base × Σ(base_effort × char_frequency)
             + w_same_finger × Σ(same_finger_penalties)
             + w_same_hand × Σ(same_hand_penalties)
             + w_row_change × Σ(row_change_penalties)
             + w_trigram × Σ(trigram_penalties)</code></pre>
</div>
<div class="section level2">
<h2 id="comparison-with-carpalx">Comparison with Carpalx<a class="anchor" aria-label="anchor" href="#comparison-with-carpalx"></a></h2>
<div class="section level3">
<h3 id="similarities-">Similarities ✓<a class="anchor" aria-label="anchor" href="#similarities-"></a></h3>
<table class="table"><thead><tr><th>Component</th>
<th>Carpalx</th>
<th>Our Implementation</th>
<th>Match</th>
</tr></thead><tbody><tr><td>Base effort</td>
<td>✓ Row, finger, distance</td>
<td>✓ Row, finger, distance</td>
<td>✓</td>
</tr><tr><td>Path penalties</td>
<td>✓ Same-finger high cost</td>
<td>✓ Same-finger bigrams</td>
<td>✓</td>
</tr><tr><td>Hand penalties</td>
<td>✓ Same-hand sequences</td>
<td>✓ Same-hand with rolls</td>
<td>✓</td>
</tr><tr><td>Stroke path</td>
<td>✓ Row jumps</td>
<td>✓ Row changes + <strong>trigrams</strong>
</td>
<td>✓</td>
</tr><tr><td>Configurability</td>
<td>✓ Weight parameters</td>
<td>✓ effort_weights list</td>
<td>✓</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="differences">Differences<a class="anchor" aria-label="anchor" href="#differences"></a></h3>
<p><strong>Carpalx:</strong> - Uses <strong>multiplicative</strong> nested formula: <code>b = b_h × b_i × (1 + k_d × d_i × (1 + k_r × r_i))</code> - More complex interaction terms - Stroke path based on triad categories</p>
<p><strong>Our Implementation:</strong> - Uses <strong>additive</strong> weighted sum (simpler, more interpretable) - Direct penalty calculations - Explicit trigram tracking for direction changes</p>
<p><strong>Result:</strong> Both approaches capture the same biomechanical principles, but our implementation is more straightforward and easier to tune.</p>
</div>
</div>
<div class="section level2">
<h2 id="verification-tests">Verification Tests<a class="anchor" aria-label="anchor" href="#verification-tests"></a></h2>
<div class="section level3">
<h3 id="test-1-component-verification">Test 1: Component Verification<a class="anchor" aria-label="anchor" href="#test-1-component-verification"></a></h3>
<p>Run the test script to verify all components are active:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/source.html" class="external-link">source</a></span><span class="op">(</span><span class="st">"test_typing_effort.R"</span><span class="op">)</span></span></code></pre></div>
<p>Expected output: - ✓ All 5 components contribute to total effort - ✓ Base effort should be 40-60% of total (most common letters on good positions) - ✓ Same-finger bigrams should be heavily penalized - ✓ Trigrams should be detected and penalized</p>
</div>
<div class="section level3">
<h3 id="test-2-qwerty-analysis">Test 2: QWERTY Analysis<a class="anchor" aria-label="anchor" href="#test-2-qwerty-analysis"></a></h3>
<p>Compare with carpalx QWERTY statistics:</p>
<p><strong>Expected patterns:</strong> - Home row usage: ~30-40% (ASDFGHJKL) - Top row usage: ~50-55% (QWERTYUIOP) - Same-finger bigrams: Relatively low (~5-10%) - Hand alternation: High (~40-50%)</p>
</div>
<div class="section level3">
<h3 id="test-3-layout-comparison">Test 3: Layout Comparison<a class="anchor" aria-label="anchor" href="#test-3-layout-comparison"></a></h3>
<p>QWERTY should perform moderately (carpalx ranks it middle-tier): - Better than: Random layouts, TNWMLC (worst) - Worse than: Dvorak, Colemak, QGMLWY (optimized)</p>
</div>
<div class="section level3">
<h3 id="test-4-optimization-convergence">Test 4: Optimization Convergence<a class="anchor" aria-label="anchor" href="#test-4-optimization-convergence"></a></h3>
<p>When optimizing a layout: - Effort should <strong>decrease</strong> over generations - Best effort should converge to a stable value - Optimized layouts should show: - More home row usage - Fewer same-finger bigrams - Better hand alternation</p>
</div>
</div>
<div class="section level2">
<h2 id="key-metrics-to-verify">Key Metrics to Verify<a class="anchor" aria-label="anchor" href="#key-metrics-to-verify"></a></h2>
<div class="section level3">
<h3 id="id_1-effort-breakdown-percentage-of-total">1. Effort Breakdown (percentage of total)<a class="anchor" aria-label="anchor" href="#id_1-effort-breakdown-percentage-of-total"></a></h3>
<p>Typical ranges for English text:</p>
<table class="table"><thead><tr><th>Component</th>
<th>Expected %</th>
<th>Notes</th>
</tr></thead><tbody><tr><td>Base effort</td>
<td>40-60%</td>
<td>Most letters typed, base cost</td>
</tr><tr><td>Same-finger</td>
<td>15-30%</td>
<td>Should be significant penalty</td>
</tr><tr><td>Same-hand</td>
<td>10-20%</td>
<td>Moderate penalty</td>
</tr><tr><td>Row change</td>
<td>5-15%</td>
<td>Varies by layout</td>
</tr><tr><td>Trigram</td>
<td>3-8%</td>
<td>New component</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="id_2-typing-statistics">2. Typing Statistics<a class="anchor" aria-label="anchor" href="#id_2-typing-statistics"></a></h3>
<p>For QWERTY on English text:</p>
<table class="table"><thead><tr><th>Metric</th>
<th>Expected Value</th>
</tr></thead><tbody><tr><td>Same-finger bigrams</td>
<td>5-10% of bigrams</td>
</tr><tr><td>Hand alternations</td>
<td>40-50% of bigrams</td>
</tr><tr><td>Home row usage</td>
<td>30-40% of chars</td>
</tr></tbody></table></div>
<div class="section level3">
<h3 id="id_3-optimization-improvement">3. Optimization Improvement<a class="anchor" aria-label="anchor" href="#id_3-optimization-improvement"></a></h3>
<p>When optimizing for English: - Should achieve <strong>15-30% improvement</strong> over QWERTY - Optimized layout should have <strong>more home row letters</strong> (50-70%) - Should have <strong>fewer same-finger bigrams</strong> (&lt;5%)</p>
</div>
</div>
<div class="section level2">
<h2 id="example-test-output">Example Test Output<a class="anchor" aria-label="anchor" href="#example-test-output"></a></h2>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">lbkeyboard</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Load test data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">english</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Analyze QWERTY</span></span>
<span><span class="va">qwerty</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/create_default_keyboard.html">create_default_keyboard</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">breakdown</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/calculate_layout_effort.html">calculate_layout_effort</a></span><span class="op">(</span></span>
<span>  keyboard <span class="op">=</span> <span class="va">qwerty</span>,</span>
<span>  text_samples <span class="op">=</span> <span class="va">english</span>,</span>
<span>  breakdown <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Expected results:</span></span>
<span><span class="co"># - total_effort: ~2000-5000 (depends on text length)</span></span>
<span><span class="co"># - same_finger_bigrams: ~100-300</span></span>
<span><span class="co"># - hand_alternations: ~800-1500</span></span>
<span><span class="co"># - same_hand_trigrams: ~200-500</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="validation-checklist">Validation Checklist<a class="anchor" aria-label="anchor" href="#validation-checklist"></a></h2>
<ul class="task-list"><li><label><input type="checkbox">All 5 effort components contribute to total effort</label></li>
<li><label><input type="checkbox">Zeroing a component weight reduces total effort</label></li>
<li><label><input type="checkbox">Same-finger bigrams are heavily penalized (high effort)</label></li>
<li><label><input type="checkbox">Trigrams are detected and counted correctly</label></li>
<li><label><input type="checkbox">Home row keys have lower base effort than top/bottom rows</label></li>
<li><label><input type="checkbox">Index fingers have lower penalty than pinkies</label></li>
<li><label><input type="checkbox">Random layouts score worse than QWERTY</label></li>
<li><label><input type="checkbox">Optimization improves effort over generations</label></li>
<li><label><input type="checkbox">Effort breakdown percentages are reasonable</label></li>
<li><label><input type="checkbox">Model is sensitive to weight parameter changes</label></li>
</ul></div>
<div class="section level2">
<h2 id="troubleshooting">Troubleshooting<a class="anchor" aria-label="anchor" href="#troubleshooting"></a></h2>
<div class="section level3">
<h3 id="issue-all-effort-is-from-one-component">Issue: All effort is from one component<a class="anchor" aria-label="anchor" href="#issue-all-effort-is-from-one-component"></a></h3>
<p><strong>Cause:</strong> Weights are unbalanced <strong>Fix:</strong> Use default weights or adjust to balance contributions</p>
</div>
<div class="section level3">
<h3 id="issue-optimization-doesnt-improve">Issue: Optimization doesn’t improve<a class="anchor" aria-label="anchor" href="#issue-optimization-doesnt-improve"></a></h3>
<p><strong>Cause:</strong> May be stuck in local minimum or weights favor conflicting goals <strong>Fix:</strong> Try different random seeds, adjust weights, increase population size</p>
</div>
<div class="section level3">
<h3 id="issue-trigram-count-is-zero">Issue: Trigram count is zero<a class="anchor" aria-label="anchor" href="#issue-trigram-count-is-zero"></a></h3>
<p><strong>Cause:</strong> Text sample too short or no same-hand sequences <strong>Fix:</strong> Use longer text with natural language patterns</p>
</div>
<div class="section level3">
<h3 id="issue-results-differ-from-carpalx">Issue: Results differ from carpalx<a class="anchor" aria-label="anchor" href="#issue-results-differ-from-carpalx"></a></h3>
<p><strong>Expected:</strong> Our model is simpler (additive vs multiplicative) <strong>Normal:</strong> Absolute values will differ, but <strong>relative rankings</strong> should match</p>
</div>
</div>
<div class="section level2">
<h2 id="mathematical-correctness">Mathematical Correctness<a class="anchor" aria-label="anchor" href="#mathematical-correctness"></a></h2>
<p>The model is mathematically sound because:</p>
<ol style="list-style-type: decimal"><li>
<strong>All terms are non-negative</strong> → effort always ≥ 0</li>
<li>
<strong>Monotonic in penalties</strong> → more difficulty = more effort</li>
<li>
<strong>Scales with text length</strong> → longer text = proportionally more effort</li>
<li>
<strong>Additive components</strong> → easy to interpret and tune</li>
<li>
<strong>Configurable weights</strong> → can adapt to different languages/preferences</li>
</ol></div>
<div class="section level2">
<h2 id="conclusion">Conclusion<a class="anchor" aria-label="anchor" href="#conclusion"></a></h2>
<p>The typing effort model is a <strong>simplified but faithful</strong> implementation of the carpalx approach:</p>
<ul><li>✅ Captures all major biomechanical factors</li>
<li>✅ Includes trigram penalties (enhancement over basic carpalx)</li>
<li>✅ Produces reasonable and interpretable results</li>
<li>✅ Suitable for keyboard layout optimization</li>
<li>✅ More accessible than original carpalx (simpler formula)</li>
</ul><p>The model should produce layouts with similar characteristics to carpalx-optimized layouts (home row emphasis, hand alternation, minimal same-finger).</p>
</div>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>

</div>



      <footer><div class="copyright">
  <p></p><p>Developed by Bruno Rodrigues.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

      </footer></div>






  </body></html>

